---
title: "TDP data processing"
output:
  html_notebook:
    code_folding: "hide"
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

```{r setup, message = FALSE}
#library("rstudioapi") #to grab local position of the script
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
knitr::opts_knit$set(root.dir = '.')

#library("rvest") # to handle html stuff

library("lubridate") # to handle dates

library('ggplot2') # for plotting
library('cowplot') # for plotting

load('worksData_TDP.RData')
```

```{r flatteningData, message = FALSE}
title <- lapply(worksData, function(x) {x$Title})
author <- lapply(worksData, function(x) {x$Author})
fandom <- lapply(worksData, function(x) {x$Fandom})
rating <- lapply(worksData, function(x) {x$Rating})
warnings <- lapply(worksData, function(x) {x$Warnings})
category <- lapply(worksData, function(x) {x$Category})
WIP <- lapply(worksData, function(x) {x$WIP})
date <-lapply(worksData, function(x) {x$Date})
nonfiction <-lapply(worksData, function(x) {x$Nonfiction})
relationships <-lapply(worksData, function(x) {x$Relationships})
character <-lapply(worksData, function(x) {x$Character})
freeform <-lapply(worksData, function(x) {x$Freeform})
language <-lapply(worksData, function(x) {x$Language})
words <-lapply(worksData, function(x) {x$Words})
kudos <-lapply(worksData, function(x) {x$Kudos})
bookmarks<-lapply(worksData, function(x) {x$Bookmarks})
hits <-lapply(worksData, function(x) {x$Hits})
```

```{r statsDensitiesWIP, message = FALSE}

stats <- data.frame(words = unlist(words, recursive = FALSE),
                    kudos = as.numeric(as.character(kudos)),
                    bookmarks = as.numeric(as.character(bookmarks)),
                    hits = as.numeric(as.character(hits)),
                    WIP = unlist(WIP, recursive = FALSE),
                    rating = unlist(rating, recursive = FALSE))

stats$rating <- factor(stats$rating, levels = c("Not Rated", "General Audiences", "Teen And Up Audiences", "Mature", "Explicit"))

kudosDensityWIP<- ggplot(stats, aes(x=kudos, col=WIP)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme()

bookmarksDensityWIP<- ggplot(stats, aes(x=bookmarks, col=WIP)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme(legend.position="none")

hitsDensityWIP<- ggplot(stats, aes(x=hits, col=WIP)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme(legend.position="none",
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

wordsDensityWIP<- ggplot(stats, aes(x=words, col=WIP)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme(legend.position="none",
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

plot_grid(kudosDensityWIP + theme(legend.position="none"),
          bookmarksDensityWIP,
          hitsDensityWIP,
          wordsDensityWIP,
          get_legend(kudosDensityWIP +
                     theme(legend.title=element_blank())))
```

```{r statsWordsWIP, message = FALSE}
wordsKudosWIP <- ggplot(stats, aes(x=words, y=kudos, col=WIP))+
  geom_point(alpha=0.3)+
  scale_x_log10()+
  scale_y_log10()+
  facet_grid(.~WIP)+
  theme_half_open() +
  background_grid() +
  theme(legend.title=element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
wordsKudosWIP

wordsBookmarksWIP <- ggplot(stats, aes(x=words, y=bookmarks, col=WIP))+
  geom_point(alpha=0.3)+
  scale_x_log10()+
  scale_y_log10()+
  facet_grid(.~WIP)+
  theme_half_open() +
  background_grid() +
  theme(legend.title=element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
wordsBookmarksWIP

wordsHitsWIP <- ggplot(stats, aes(x=words, y=hits, col=WIP))+
  geom_point(alpha=0.3)+
  scale_x_log10()+
  scale_y_log10()+
  facet_grid(.~WIP)+
  theme_half_open() +
  background_grid() +
  theme(legend.title=element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
wordsHitsWIP

```


```{r statsDensitiesRating, message = FALSE}

kudosDensityRating<- ggplot(stats, aes(x=kudos, col=rating)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme()

bookmarksDensityRating<- ggplot(stats, aes(x=bookmarks, col=rating)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme(legend.position="none")

hitsDensityRating<- ggplot(stats, aes(x=hits, col=rating)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme(legend.position="none",
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

wordsDensityRating<- ggplot(stats, aes(x=words, col=rating)) +
  geom_density()+
  scale_x_log10()+
  theme_half_open() +
  background_grid() +
  theme(legend.position="none",
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

plot_grid(kudosDensityRating + theme(legend.position="none"),
          bookmarksDensityRating,
          hitsDensityRating,
          wordsDensityRating,
          get_legend(kudosDensityRating +
                     theme(legend.title=element_blank())))
```


```{r statsWordsRating, message = FALSE, fig.width=13, fig.height=5}
wordsKudosRating <- ggplot(stats, aes(x=words, y=kudos, col=rating))+
  geom_point(alpha=0.3)+
  scale_x_log10()+
  scale_y_log10()+
  facet_grid(.~rating)+
  theme_half_open() +
  background_grid() +
  theme(legend.title=element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
wordsKudosRating

wordsBookmarksRating <- ggplot(stats, aes(x=words, y=bookmarks, col=rating))+
  geom_point(alpha=0.3)+
  scale_x_log10()+
  scale_y_log10()+
  facet_grid(.~rating)+
  theme_half_open() +
  background_grid() +
  theme(legend.title=element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
wordsBookmarksRating

wordsHitsRating <- ggplot(stats, aes(x=words, y=hits, col=rating))+
  geom_point(alpha=0.3)+
  scale_x_log10()+
  scale_y_log10()+
  facet_grid(.~rating)+
  theme_half_open() +
  background_grid() +
  theme(legend.title=element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
wordsHitsRating

```